<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Capítulo 7 Análisis de ocupación, metodo ML | Simulación y análisis de ocupación</title>
  <meta name="description" content="This is an R example to get occupancy data and analize it." />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="Capítulo 7 Análisis de ocupación, metodo ML | Simulación y análisis de ocupación" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="images/venado_large.png" />
  <meta property="og:description" content="This is an R example to get occupancy data and analize it." />
  <meta name="github-repo" content="dlizcano/IntroOccuBook" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Capítulo 7 Análisis de ocupación, metodo ML | Simulación y análisis de ocupación" />
  
  <meta name="twitter:description" content="This is an R example to get occupancy data and analize it." />
  <meta name="twitter:image" content="images/venado_large.png" />

<meta name="author" content="Diego J. Lizcano, Ph.D." />


<meta name="date" content="2020-04-20" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<link rel="prev" href="function1.html"/>
<link rel="next" href="bayesian.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Simulaciones y análisis de ocupación</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Prerequisitos</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introducción</a></li>
<li class="chapter" data-level="3" data-path="why.html"><a href="why.html"><i class="fa fa-check"></i><b>3</b> Por qué simular?</a><ul>
<li class="chapter" data-level="3.1" data-path="why.html"><a href="why.html#por-qué-son-útiles-las-simulaciones"><i class="fa fa-check"></i><b>3.1</b> por qué son útiles las simulaciones:</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="occu.html"><a href="occu.html"><i class="fa fa-check"></i><b>4</b> La ocupación de hábitat</a></li>
<li class="chapter" data-level="5" data-path="example.html"><a href="example.html"><i class="fa fa-check"></i><b>5</b> Nuestro ejemplo:</a><ul>
<li class="chapter" data-level="5.0.1" data-path="example.html"><a href="example.html#modelo-ecológico"><i class="fa fa-check"></i><b>5.0.1</b> Modelo Ecológico:</a></li>
<li class="chapter" data-level="5.0.2" data-path="example.html"><a href="example.html#modelo-de-observación"><i class="fa fa-check"></i><b>5.0.2</b> Modelo de Observación:</a></li>
<li class="chapter" data-level="5.1" data-path="example.html"><a href="example.html#pasos-iniciales-tamaño-de-la-muestra-y-valores-de-las-co-variables"><i class="fa fa-check"></i><b>5.1</b> Pasos iniciales: tamaño de la muestra y valores de las co-variables</a></li>
<li class="chapter" data-level="5.2" data-path="example.html"><a href="example.html#simulando-el-proceso-ecológico-y-su-resultado-la-ocurrencia-del-venado"><i class="fa fa-check"></i><b>5.2</b> Simulando el proceso ecológico y su resultado: la ocurrencia del venado</a><ul>
<li class="chapter" data-level="5.2.1" data-path="example.html"><a href="example.html#por-qué-bernoulli"><i class="fa fa-check"></i><b>5.2.1</b> Por qué Bernoulli?</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="example.html"><a href="example.html#simulando-el-proceso-de-observación-y-su-resultado-la-detección"><i class="fa fa-check"></i><b>5.3</b> Simulando el proceso de observación y su resultado: la detección</a><ul>
<li class="chapter" data-level="5.3.1" data-path="example.html"><a href="example.html#uniendo-los-dos-procesos-el-ecológico-y-el-de-observación"><i class="fa fa-check"></i><b>5.3.1</b> Uniendo los dos procesos el ecológico y el de observación</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="function1.html"><a href="function1.html"><i class="fa fa-check"></i><b>6</b> Empacando todo en una función</a></li>
<li class="chapter" data-level="7" data-path="unmarked.html"><a href="unmarked.html"><i class="fa fa-check"></i><b>7</b> Análisis de ocupación, metodo ML</a><ul>
<li class="chapter" data-level="7.0.1" data-path="unmarked.html"><a href="unmarked.html#limpiando-la-memoria-de-r"><i class="fa fa-check"></i><b>7.0.1</b> Limpiando la memoria de R</a></li>
<li class="chapter" data-level="7.1" data-path="unmarked.html"><a href="unmarked.html#generando-los-datos"><i class="fa fa-check"></i><b>7.1</b> Generando los datos</a></li>
<li class="chapter" data-level="7.2" data-path="unmarked.html"><a href="unmarked.html#poniendo-los-datos-en-unmarked"><i class="fa fa-check"></i><b>7.2</b> Poniendo los datos en unmarked</a></li>
<li class="chapter" data-level="7.3" data-path="unmarked.html"><a href="unmarked.html#ajustando-los-modelos"><i class="fa fa-check"></i><b>7.3</b> Ajustando los modelos</a></li>
<li class="chapter" data-level="7.4" data-path="unmarked.html"><a href="unmarked.html#selección-de-modelos"><i class="fa fa-check"></i><b>7.4</b> Selección de modelos</a></li>
<li class="chapter" data-level="7.5" data-path="unmarked.html"><a href="unmarked.html#predicción-en-graficas"><i class="fa fa-check"></i><b>7.5</b> Predicción en graficas</a></li>
<li class="chapter" data-level="7.6" data-path="unmarked.html"><a href="unmarked.html#predicción-espacialmente-explicita"><i class="fa fa-check"></i><b>7.6</b> Predicción espacialmente explicita</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="bayesian.html"><a href="bayesian.html"><i class="fa fa-check"></i><b>8</b> Análisis Bayesiano</a><ul>
<li class="chapter" data-level="8.1" data-path="bayesian.html"><a href="bayesian.html#generando-los-datos-1"><i class="fa fa-check"></i><b>8.1</b> Generando los datos</a></li>
<li class="chapter" data-level="8.2" data-path="bayesian.html"><a href="bayesian.html#comparando-los-valores-reales-y-los-estimados-de-ml-y-bayesiano"><i class="fa fa-check"></i><b>8.2</b> Comparando los valores reales y los estimados de ML y Bayesiano</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="información-de-la-sesión-de-r-y-los-paquetes-usados.html"><a href="información-de-la-sesión-de-r-y-los-paquetes-usados.html"><i class="fa fa-check"></i><b>9</b> Información de la sesión de R y los paquetes usados</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/dlizcano/IntroOccuBook" target="_blank">Publicado con bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Simulación y análisis de ocupación</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="unmarked" class="section level1">
<h1><span class="header-section-number">Capítulo 7</span> Análisis de ocupación, metodo ML</h1>
<p>Ya que hemos entendido como funcionan e interactúan los dos procesos; el ecológico y el observacional para producir los datos de ocupación. Luego de generar varios sets de datos, ahora solo nos resta analizarlos. La forma más directa e intuitiva es usar la función occu del paquete unmarked <span class="citation">(Fiske &amp; Chandler, <a href="#ref-Fiske2011" role="doc-biblioref">2011</a>)</span>. Posteriormente podremos usar un modelo de tipo bayesiano en el lenguaje BUGS para analizar los mismos datos y al final comparar cuál de los dos estimadores, Máxima Verosimilitud o Bayesiano, se acerca más a los parámetros verdaderos.</p>
<div id="limpiando-la-memoria-de-r" class="section level3">
<h3><span class="header-section-number">7.0.1</span> Limpiando la memoria de R</h3>
<p>Antes de continuar, y como ya hemos generado una gran cantidad de datos y modelos en los pasos previos, vamos a borrar la memoria de R antes de comenzar. Esto lo hacemos con el comando:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" title="1"><span class="kw">rm</span>(<span class="dt">list =</span> <span class="kw">ls</span>())</a></code></pre></div>
<p>Una vez hayamos hecho esto debemos volver a correr el código de la función que genera los datos que hemos creado el Capítulo <a href="function1.html#function1">6</a>.</p>
</div>
<div id="generando-los-datos" class="section level2">
<h2><span class="header-section-number">7.1</span> Generando los datos</h2>
<p>Esta vez recurriremos a un diseño tipo TEAM (<a href="http://www.teamnetwork.org" class="uri">http://www.teamnetwork.org</a>) con 60 sitios de muestreo y 30 visitas repetidas, que equivalen a los 30 días en que las cámaras permanecen activas en campo. De nuevo nuestra especie es el venado de cola blanca. Para este ejemplo asumiremos que la detección es 0.6, la ocupación 0.8 y las interacciones son mucho más sencillas con la altitud como la única covariable que explica la ocupación. Sin embargo para la detección hay una relación más compleja, asumiendo que hay una leve interacción entre las covariables de la observación. Para la observación la altitud y temperatura interactúan entre sí. También observe como la altitud influye en direcciones opuestas con un signo positivo en la altitud para la detección y negativo para la ocupación.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" title="1"><span class="co"># Data generation</span></a>
<a class="sourceLine" id="cb28-2" title="2"><span class="co"># Lets build a model were elevation explain occupancy and p has interactions</span></a>
<a class="sourceLine" id="cb28-3" title="3">datos2&lt;-<span class="kw">data.fn</span>(<span class="dt">M =</span> <span class="dv">60</span>, <span class="dt">J =</span> <span class="dv">30</span>, <span class="dt">show.plot =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb28-4" title="4">                <span class="dt">mean.occupancy =</span> <span class="fl">0.8</span>, <span class="dt">beta1 =</span> <span class="fl">-1.5</span>, <span class="dt">beta2 =</span> <span class="dv">0</span>, <span class="dt">beta3 =</span> <span class="dv">0</span>,  </a>
<a class="sourceLine" id="cb28-5" title="5">                <span class="dt">mean.detection =</span> <span class="fl">0.6</span>, <span class="dt">alpha1 =</span> <span class="dv">2</span>, <span class="dt">alpha2 =</span> <span class="dv">1</span>, <span class="dt">alpha3 =</span> <span class="fl">1.5</span></a>
<a class="sourceLine" id="cb28-6" title="6">                )</a>
<a class="sourceLine" id="cb28-7" title="7"></a>
<a class="sourceLine" id="cb28-8" title="8"><span class="co"># Function to simulate occupancy measurements replicated at M sites during J occasions.</span></a>
<a class="sourceLine" id="cb28-9" title="9"><span class="co"># Population closure is assumed for each site.</span></a>
<a class="sourceLine" id="cb28-10" title="10"><span class="co"># Expected occurrence may be affected by elevation (elev), </span></a>
<a class="sourceLine" id="cb28-11" title="11"><span class="co"># forest cover (forest) and their interaction.</span></a>
<a class="sourceLine" id="cb28-12" title="12"><span class="co"># Expected detection probability may be affected by elevation, </span></a>
<a class="sourceLine" id="cb28-13" title="13"><span class="co"># temperature (temp) and their interaction.</span></a>
<a class="sourceLine" id="cb28-14" title="14"><span class="co"># Function arguments:</span></a>
<a class="sourceLine" id="cb28-15" title="15"><span class="co">#     M: Number of spatial replicates (sites)</span></a>
<a class="sourceLine" id="cb28-16" title="16"><span class="co">#     J: Number of temporal replicates (occasions)</span></a>
<a class="sourceLine" id="cb28-17" title="17"><span class="co">#     mean.occupancy: Mean occurrence at value 0 of occurrence covariates</span></a>
<a class="sourceLine" id="cb28-18" title="18"><span class="co">#     beta1: Main effect of elevation on occurrence</span></a>
<a class="sourceLine" id="cb28-19" title="19"><span class="co">#     beta2: Main effect of forest cover on occurrence</span></a>
<a class="sourceLine" id="cb28-20" title="20"><span class="co">#     beta3: Interaction effect on occurrence of elevation and forest cover</span></a>
<a class="sourceLine" id="cb28-21" title="21"><span class="co">#     mean.detection: Mean detection prob. at value 0 of detection covariates</span></a>
<a class="sourceLine" id="cb28-22" title="22"><span class="co">#     alpha1: Main effect of elevation on detection probability</span></a>
<a class="sourceLine" id="cb28-23" title="23"><span class="co">#     alpha2: Main effect of temperature on detection probability</span></a>
<a class="sourceLine" id="cb28-24" title="24"><span class="co">#     alpha3: Interaction effect on detection of elevation and temperature</span></a>
<a class="sourceLine" id="cb28-25" title="25"><span class="co">#     show.plot: if TRUE, plots of the data will be displayed; </span></a>
<a class="sourceLine" id="cb28-26" title="26"><span class="co">#               set to FALSE if you are running simulations.</span></a>
<a class="sourceLine" id="cb28-27" title="27"></a>
<a class="sourceLine" id="cb28-28" title="28"></a>
<a class="sourceLine" id="cb28-29" title="29"><span class="co">#To make the objects inside the list directly accessible to R, without having to address </span></a>
<a class="sourceLine" id="cb28-30" title="30"><span class="co">#them as data$C for instance, you can attach datos2 to the search path.</span></a>
<a class="sourceLine" id="cb28-31" title="31"></a>
<a class="sourceLine" id="cb28-32" title="32"><span class="kw">attach</span>(datos2)         <span class="co"># Make objects inside of &#39;datos2&#39; accessible directly</span></a>
<a class="sourceLine" id="cb28-33" title="33"></a>
<a class="sourceLine" id="cb28-34" title="34"><span class="co">#Remember to detach the data after use, and in particular before attaching a new data </span></a>
<a class="sourceLine" id="cb28-35" title="35"><span class="co">#object, because more than one data set attached in the search path will cause confusion.</span></a>
<a class="sourceLine" id="cb28-36" title="36"></a>
<a class="sourceLine" id="cb28-37" title="37"><span class="co"># detach(datos2)         # Make clean up</span></a></code></pre></div>
</div>
<div id="poniendo-los-datos-en-unmarked" class="section level2">
<h2><span class="header-section-number">7.2</span> Poniendo los datos en unmarked</h2>
<p><a href="http://cran.r-project.org/web/packages/unmarked/index.html">Unmarked</a> es el paquete de R que usamos para analizar los datos de ocupación <span class="citation">(Fiske &amp; Chandler, <a href="#ref-Fiske2011" role="doc-biblioref">2011</a>)</span>. Para lograr esto debemos primero preparar los datos y juntarlos en un objeto de tipo unmarkedFrame. En este caso usamos la función unmarkedFrameOccu que es específica para análisis de ocupación de una sola época o estación. Más sobre unkarked en: <a href="https://sites.google.com/site/unmarkedinfo/home" class="uri">https://sites.google.com/site/unmarkedinfo/home</a></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" title="1"><span class="kw">library</span>(unmarked)</a>
<a class="sourceLine" id="cb29-2" title="2">siteCovs &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">cbind</span>(forest,elev)) <span class="co"># occupancy covariates </span></a>
<a class="sourceLine" id="cb29-3" title="3">obselev&lt;-<span class="kw">matrix</span>(<span class="kw">rep</span>(elev,J),<span class="dt">ncol =</span> J) <span class="co"># make elevetion per observation</span></a>
<a class="sourceLine" id="cb29-4" title="4">obsCovs &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">temp=</span> temp,<span class="dt">elev=</span>obselev) <span class="co"># detection covariates</span></a>
<a class="sourceLine" id="cb29-5" title="5"></a>
<a class="sourceLine" id="cb29-6" title="6"><span class="co"># umf is the object joining observations (y), occupancy covariates (siteCovs)</span></a>
<a class="sourceLine" id="cb29-7" title="7"><span class="co"># and detection covariates (obsCovs). Note that obsCovs should be a list of </span></a>
<a class="sourceLine" id="cb29-8" title="8"><span class="co"># matrices or dataframes.</span></a>
<a class="sourceLine" id="cb29-9" title="9"></a>
<a class="sourceLine" id="cb29-10" title="10">umf &lt;-<span class="st"> </span><span class="kw">unmarkedFrameOccu</span>(<span class="dt">y =</span> y, <span class="dt">siteCovs =</span> siteCovs, <span class="dt">obsCovs =</span> obsCovs)</a></code></pre></div>
<p>El paquete unmarked nos permite ver gráficamente como están dispuestos los datos en los sitios de muestreo con la función plot.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" title="1"><span class="kw">plot</span> (umf)</a></code></pre></div>
<div class="figure"><span id="fig:umfplot"></span>
<img src="IntroOccuBook_files/figure-html/umfplot-1.png" alt="Inspección grafica del objeto umf." width="672" />
<p class="caption">
Figure 7.1: Inspección grafica del objeto umf.
</p>
</div>
</div>
<div id="ajustando-los-modelos" class="section level2">
<h2><span class="header-section-number">7.3</span> Ajustando los modelos</h2>
<p>El siguiente paso es ajustar los modelos que se requerían variando las co-variables. Esto se logra con la <a href="http://www.rdocumentation.org/packages/unmarked/versions/0.11-0/topics/occu">función occu()</a>.</p>
<p>Tenga en cuenta que en el proceso de construcción de modelos su modelo debe tener un significado biológico.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" title="1"><span class="co"># detection first, occupancy next</span></a>
<a class="sourceLine" id="cb31-2" title="2">fm0 &lt;-<span class="st"> </span><span class="kw">occu</span>(<span class="op">~</span><span class="dv">1</span> <span class="op">~</span><span class="dv">1</span>, umf) <span class="co"># Null model</span></a>
<a class="sourceLine" id="cb31-3" title="3">fm1 &lt;-<span class="st"> </span><span class="kw">occu</span>(<span class="op">~</span><span class="st"> </span>elev <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, umf) <span class="co"># elev explaining detection</span></a>
<a class="sourceLine" id="cb31-4" title="4">fm2 &lt;-<span class="st"> </span><span class="kw">occu</span>(<span class="op">~</span><span class="st"> </span>elev <span class="op">~</span><span class="st"> </span>elev, umf) <span class="co"># elev explaining detection and occupancy</span></a>
<a class="sourceLine" id="cb31-5" title="5">fm3 &lt;-<span class="st"> </span><span class="kw">occu</span>(<span class="op">~</span><span class="st"> </span>temp <span class="op">~</span><span class="st"> </span>elev, umf)</a>
<a class="sourceLine" id="cb31-6" title="6">fm4 &lt;-<span class="st"> </span><span class="kw">occu</span>(<span class="op">~</span><span class="st"> </span>temp <span class="op">~</span><span class="st"> </span>forest, umf)</a>
<a class="sourceLine" id="cb31-7" title="7">fm5 &lt;-<span class="st"> </span><span class="kw">occu</span>(<span class="op">~</span><span class="st"> </span>elev <span class="op">+</span><span class="st"> </span>temp <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, umf)</a>
<a class="sourceLine" id="cb31-8" title="8">fm6 &lt;-<span class="st"> </span><span class="kw">occu</span>(<span class="op">~</span><span class="st"> </span>elev <span class="op">+</span><span class="st"> </span>temp <span class="op">+</span><span class="st"> </span>elev<span class="op">:</span>temp <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, umf)</a>
<a class="sourceLine" id="cb31-9" title="9">fm7 &lt;-<span class="st"> </span><span class="kw">occu</span>(<span class="op">~</span><span class="st"> </span>elev <span class="op">+</span><span class="st"> </span>temp <span class="op">+</span><span class="st"> </span>elev<span class="op">:</span>temp <span class="op">~</span><span class="st"> </span>elev, umf)</a>
<a class="sourceLine" id="cb31-10" title="10">fm8 &lt;-<span class="st"> </span><span class="kw">occu</span>(<span class="op">~</span><span class="st"> </span>elev <span class="op">+</span><span class="st"> </span>temp <span class="op">+</span><span class="st"> </span>elev<span class="op">:</span>temp <span class="op">~</span><span class="st"> </span>forest, umf)</a></code></pre></div>
</div>
<div id="selección-de-modelos" class="section level2">
<h2><span class="header-section-number">7.4</span> Selección de modelos</h2>
<p>Unmarked permite hacer selección de modelos basándose en el AIC de cada uno. De forma tal que el menor AIC es el modelo más parsimonioso de acuerdo a nuestros datos <span class="citation">(Burnham &amp; Anderson, <a href="#ref-Burnham2004" role="doc-biblioref">2004</a>)</span>.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" title="1">models &lt;-<span class="st"> </span><span class="kw">fitList</span>( <span class="co"># here e put names to the models</span></a>
<a class="sourceLine" id="cb32-2" title="2">  <span class="st">&#39;p(.)psi(.)&#39;</span>                        =<span class="st"> </span>fm0,</a>
<a class="sourceLine" id="cb32-3" title="3">  <span class="st">&#39;p(elev)psi(.)&#39;</span>                     =<span class="st"> </span>fm1,</a>
<a class="sourceLine" id="cb32-4" title="4">  <span class="st">&#39;p(elev)psi(elev)&#39;</span>                  =<span class="st"> </span>fm2,</a>
<a class="sourceLine" id="cb32-5" title="5">  <span class="st">&#39;p(temp)psi(elev)&#39;</span>                  =<span class="st"> </span>fm3,</a>
<a class="sourceLine" id="cb32-6" title="6">  <span class="st">&#39;p(temp)psi(forest)&#39;</span>                =<span class="st"> </span>fm4,</a>
<a class="sourceLine" id="cb32-7" title="7">  <span class="st">&#39;p(temp+elev)psi(.)&#39;</span>                =<span class="st"> </span>fm5,</a>
<a class="sourceLine" id="cb32-8" title="8">  <span class="st">&#39;p(temp+elev+elev:temp)psi(.)&#39;</span>      =<span class="st"> </span>fm6,</a>
<a class="sourceLine" id="cb32-9" title="9">  <span class="st">&#39;p(temp+elev+elev:temp)psi(elev)&#39;</span>   =<span class="st"> </span>fm7,</a>
<a class="sourceLine" id="cb32-10" title="10">  <span class="st">&#39;p(temp+elev+elev:temp)psi(forest)&#39;</span> =<span class="st"> </span>fm8)</a>
<a class="sourceLine" id="cb32-11" title="11"></a>
<a class="sourceLine" id="cb32-12" title="12"><span class="kw">modSel</span>(models) <span class="co"># model selection procedure</span></a></code></pre></div>
<pre><code>##                                   nPars     AIC  delta
## p(temp+elev+elev:temp)psi(elev)       6 1630.77   0.00
## p(temp+elev+elev:temp)psi(.)          5 1636.27   5.49
## p(temp+elev+elev:temp)psi(forest)     6 1638.24   7.47
## p(temp+elev)psi(.)                    4 1672.55  41.78
## p(elev)psi(elev)                      4 1741.34 110.57
## p(elev)psi(.)                         3 1746.83 116.06
## p(temp)psi(elev)                      4 1898.56 267.79
## p(temp)psi(forest)                    4 1906.03 275.26
## p(.)psi(.)                            2 1969.25 338.48
##                                     AICwt cumltvWt
## p(temp+elev+elev:temp)psi(elev)   9.2e-01     0.92
## p(temp+elev+elev:temp)psi(.)      5.9e-02     0.98
## p(temp+elev+elev:temp)psi(forest) 2.2e-02     1.00
## p(temp+elev)psi(.)                7.8e-10     1.00
## p(elev)psi(elev)                  9.0e-25     1.00
## p(elev)psi(.)                     5.8e-26     1.00
## p(temp)psi(elev)                  6.5e-59     1.00
## p(temp)psi(forest)                1.6e-60     1.00
## p(.)psi(.)                        2.9e-74     1.00</code></pre>
</div>
<div id="predicción-en-graficas" class="section level2">
<h2><span class="header-section-number">7.5</span> Predicción en graficas</h2>
<p>El modelo con menor AIC puede ser usado para predecir resultados esperados de acuerdo a un nuevo set de datos. Por ejemplo, uno podría preguntar la abundancia de venados que se espera encontrar en un sitio con mayor altitud. Las predicciones también son otra forma de presentar los resultados de un análisis. Aquí ilustraremos como se ve la predicción de <span class="math inline">\(\psi\)</span> y <em>p</em> sobre el rango de las covariables estudiadas. Note que estamos usando covariables estandarizadas. Si estuviéramos usando covariables en su escala real, tendríamos que tener en cuenta que hay que transformarlas usando la media y la desviación estándar.</p>
<p>Antes de usar el modelo para predecir es buena idea verificar los parámetros del modelo y sus errores, posteriormente verificar gráficamente que el modelo ajusta bien con la función parboot, la cual hace un remuestreo del modelo. Esta grafica se interpreta como que el modelo tiene buen ajuste, cuando la media (línea punteada) está entre los intervalos del histograma. Si la línea se encuentra muy lejos del histograma el modelo no podría ser bueno para predecir.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" title="1"><span class="kw">summary</span>(fm7) <span class="co"># see the model parameters</span></a></code></pre></div>
<pre><code>## 
## Call:
## occu(formula = ~elev + temp + elev:temp ~ elev, data = umf)
## 
## Occupancy (logit-scale):
##             Estimate    SE     z  P(&gt;|z|)
## (Intercept)     1.41 0.366  3.85 0.000117
## elev           -1.63 0.656 -2.48 0.013082
## 
## Detection (logit-scale):
##             Estimate     SE     z  P(&gt;|z|)
## (Intercept)     0.53 0.0698  7.60 3.04e-14
## elev            1.80 0.1277 14.10 3.56e-45
## temp            1.16 0.1209  9.57 1.08e-21
## elev:temp       1.33 0.2211  6.00 1.96e-09
## 
## AIC: 1630.771 
## Number of sites: 60
## optim convergence code: 0
## optim iterations: 31 
## Bootstrap iterations: 0</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" title="1">pb &lt;-<span class="st"> </span><span class="kw">parboot</span>(fm7, <span class="dt">nsim=</span><span class="dv">250</span>, <span class="dt">report=</span><span class="dv">10</span>) <span class="co"># goodness of fit</span></a></code></pre></div>
<pre><code>## t0 = 409.3793</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" title="1"><span class="kw">plot</span> (pb) <span class="co"># plot goodness of fit</span></a></code></pre></div>
<div class="figure"><span id="fig:fit1"></span>
<img src="IntroOccuBook_files/figure-html/fit1-1.png" alt="Evaluación grafica del ajuste del modelo fm7." width="672" />
<p class="caption">
Figure 7.2: Evaluación grafica del ajuste del modelo fm7.
</p>
</div>
<p>Ahora que sabemos que nuestro mejor modelo tiene buen ajuste, podemos usarlo para predecir la ocupación en el rango de la altitud para ver su comportamiento en una gráfica.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" title="1">elevrange&lt;-<span class="kw">data.frame</span>(<span class="dt">elev=</span><span class="kw">seq</span>(<span class="kw">min</span>(datos2<span class="op">$</span>elev),<span class="kw">max</span>(datos2<span class="op">$</span>elev),<span class="dt">length=</span><span class="dv">100</span>)) <span class="co"># newdata</span></a>
<a class="sourceLine" id="cb39-2" title="2">pred_psi &lt;-<span class="kw">predict</span>(fm7,<span class="dt">type=</span><span class="st">&quot;state&quot;</span>,<span class="dt">newdata=</span>elevrange,<span class="dt">appendData=</span><span class="ot">TRUE</span>) </a>
<a class="sourceLine" id="cb39-3" title="3"><span class="kw">plot</span>(Predicted<span class="op">~</span>elev, pred_psi,<span class="dt">type=</span><span class="st">&quot;l&quot;</span>,<span class="dt">col=</span><span class="st">&quot;blue&quot;</span>,</a>
<a class="sourceLine" id="cb39-4" title="4">       <span class="dt">xlab=</span><span class="st">&quot;elev&quot;</span>,</a>
<a class="sourceLine" id="cb39-5" title="5">       <span class="dt">ylab=</span><span class="st">&quot;psi&quot;</span>)</a>
<a class="sourceLine" id="cb39-6" title="6"><span class="kw">lines</span>(lower<span class="op">~</span>elev, pred_psi,<span class="dt">type=</span><span class="st">&quot;l&quot;</span>,<span class="dt">col=</span><span class="kw">gray</span>(<span class="fl">0.5</span>))</a>
<a class="sourceLine" id="cb39-7" title="7"><span class="kw">lines</span>(upper<span class="op">~</span>elev, pred_psi,<span class="dt">type=</span><span class="st">&quot;l&quot;</span>,<span class="dt">col=</span><span class="kw">gray</span>(<span class="fl">0.5</span>))</a></code></pre></div>
<div class="figure"><span id="fig:gpsi"></span>
<img src="IntroOccuBook_files/figure-html/gpsi-1.png" alt="Grafica de la ocupación con respecto a la elevación." width="672" />
<p class="caption">
Figure 7.3: Grafica de la ocupación con respecto a la elevación.
</p>
</div>
</div>
<div id="predicción-espacialmente-explicita" class="section level2">
<h2><span class="header-section-number">7.6</span> Predicción espacialmente explicita</h2>
<p>Podemos también usar el mejor modelo para predecir de forma espacialmente explicita sí tenemos los mapas. Como ilustración vamos a construir mapas simulados para cada una de nuestras covariables. Los mapas surgen de un patrón aleatorio de puntos con distribución Poisson. Luego estos puntos los convertimos en una superficie interpolada.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" title="1"><span class="co"># lets make random maps for the three covariates</span></a>
<a class="sourceLine" id="cb40-2" title="2"><span class="kw">library</span>(raster)</a>
<a class="sourceLine" id="cb40-3" title="3"><span class="kw">library</span>(spatstat)</a>
<a class="sourceLine" id="cb40-4" title="4"><span class="kw">set.seed</span>(<span class="dv">24</span>) <span class="co"># Remove for random simulations</span></a>
<a class="sourceLine" id="cb40-5" title="5"></a>
<a class="sourceLine" id="cb40-6" title="6"><span class="co"># CONSTRUCT ANALYSIS WINDOW USING THE FOLLOWING:</span></a>
<a class="sourceLine" id="cb40-7" title="7">xrange=<span class="kw">c</span>(<span class="op">-</span><span class="fl">2.5</span>, <span class="fl">1002.5</span>)</a>
<a class="sourceLine" id="cb40-8" title="8">yrange=<span class="kw">c</span>(<span class="op">-</span><span class="fl">2.5</span>, <span class="fl">502.5</span>)</a>
<a class="sourceLine" id="cb40-9" title="9">window&lt;-<span class="kw">owin</span>(xrange, yrange)</a>
<a class="sourceLine" id="cb40-10" title="10"></a>
<a class="sourceLine" id="cb40-11" title="11"><span class="co"># Build maps from random points and interpole in same line</span></a>
<a class="sourceLine" id="cb40-12" title="12">elev   &lt;-<span class="st"> </span><span class="kw">density</span>(<span class="kw">rpoispp</span>(<span class="dt">lambda=</span><span class="fl">0.6</span>, <span class="dt">win=</span>window)) <span class="co"># </span></a>
<a class="sourceLine" id="cb40-13" title="13">forest &lt;-<span class="st"> </span><span class="kw">density</span>(<span class="kw">rpoispp</span>(<span class="dt">lambda=</span><span class="fl">0.2</span>, <span class="dt">win=</span>window)) <span class="co"># </span></a>
<a class="sourceLine" id="cb40-14" title="14">temp   &lt;-<span class="st"> </span><span class="kw">density</span>(<span class="kw">rpoispp</span>(<span class="dt">lambda=</span><span class="fl">0.5</span>, <span class="dt">win=</span>window)) <span class="co"># </span></a>
<a class="sourceLine" id="cb40-15" title="15"></a>
<a class="sourceLine" id="cb40-16" title="16"><span class="co"># Convert covs to raster and Put in the same stack </span></a>
<a class="sourceLine" id="cb40-17" title="17">mapdata.m&lt;-<span class="kw">stack</span>(<span class="kw">raster</span>(elev),<span class="kw">raster</span>(forest), <span class="kw">raster</span>(temp)) </a>
<a class="sourceLine" id="cb40-18" title="18"><span class="kw">names</span>(mapdata.m)&lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;elev&quot;</span>, <span class="st">&quot;forest&quot;</span>, <span class="st">&quot;temp&quot;</span>) <span class="co"># put names to raster</span></a>
<a class="sourceLine" id="cb40-19" title="19"></a>
<a class="sourceLine" id="cb40-20" title="20"><span class="co"># lets plot the covs maps</span></a>
<a class="sourceLine" id="cb40-21" title="21"><span class="kw">plot</span>(mapdata.m)</a></code></pre></div>
<div class="figure"><span id="fig:spat"></span>
<img src="IntroOccuBook_files/figure-html/spat-1.png" alt="Mapa simulado de elevación, bosque y temperatura." width="672" />
<p class="caption">
Figure 7.4: Mapa simulado de elevación, bosque y temperatura.
</p>
</div>
<p>Una vez tenemos nuestros mapas de covariables, los usamos para predecir con el mejor modelo. De esta forma podemos tener un mapa con predicciones de la ocupación y la probabilidad de detección.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" title="1"><span class="co"># make the predictions </span></a>
<a class="sourceLine" id="cb41-2" title="2">predictions_psi &lt;-<span class="st"> </span><span class="kw">predict</span>(fm7, <span class="dt">type=</span><span class="st">&quot;state&quot;</span>, <span class="dt">newdata=</span>mapdata.m) <span class="co"># predict psi</span></a></code></pre></div>
<pre><code>##   doing row 1000 of 16384 
##   doing row 2000 of 16384 
##   doing row 3000 of 16384 
##   doing row 4000 of 16384 
##   doing row 5000 of 16384 
##   doing row 6000 of 16384 
##   doing row 7000 of 16384 
##   doing row 8000 of 16384 
##   doing row 9000 of 16384 
##   doing row 10000 of 16384 
##   doing row 11000 of 16384 
##   doing row 12000 of 16384 
##   doing row 13000 of 16384 
##   doing row 14000 of 16384 
##   doing row 15000 of 16384 
##   doing row 16000 of 16384</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" title="1">predictions_p   &lt;-<span class="st"> </span><span class="kw">predict</span>(fm7, <span class="dt">type=</span><span class="st">&quot;det&quot;</span>,   <span class="dt">newdata=</span>mapdata.m) <span class="co"># predict p</span></a></code></pre></div>
<pre><code>##   doing row 1000 of 16384 
##   doing row 2000 of 16384 
##   doing row 3000 of 16384 
##   doing row 4000 of 16384 
##   doing row 5000 of 16384 
##   doing row 6000 of 16384 
##   doing row 7000 of 16384 
##   doing row 8000 of 16384 
##   doing row 9000 of 16384 
##   doing row 10000 of 16384 
##   doing row 11000 of 16384 
##   doing row 12000 of 16384 
##   doing row 13000 of 16384 
##   doing row 14000 of 16384 
##   doing row 15000 of 16384 
##   doing row 16000 of 16384</code></pre>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" title="1"><span class="co"># put in the same stack</span></a>
<a class="sourceLine" id="cb45-2" title="2">predmaps&lt;-<span class="kw">stack</span>(predictions_psi<span class="op">$</span>Predicted,predictions_p<span class="op">$</span>Predicted) </a>
<a class="sourceLine" id="cb45-3" title="3"><span class="kw">names</span>(predmaps)&lt;-<span class="kw">c</span>(<span class="st">&quot;psi_predicted&quot;</span>, <span class="st">&quot;p_predicted&quot;</span>) <span class="co"># put names</span></a>
<a class="sourceLine" id="cb45-4" title="4"><span class="kw">plot</span>(predmaps)</a></code></pre></div>
<div class="figure"><span id="fig:spatr"></span>
<img src="IntroOccuBook_files/figure-html/spatr-1.png" alt="Modelos de ocupación y detección espacialmente explícitos." width="672" />
<p class="caption">
Figure 7.5: Modelos de ocupación y detección espacialmente explícitos.
</p>
</div>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-Burnham2004">
<p>Burnham, K. P., &amp; Anderson, D. R. (2004). Information and likelihood theory: A basis for model selection and inference. In K. P. Burnham &amp; D. R. Anderson (Eds.), <em>Model selection and multimodel inference: A practical information-theoretic approach</em> (pp. 49–97). Retrieved from <a href="http://link.springer.com/chapter/10.1007%2F978-0-387-22456-5_2">http://link.springer.com/chapter/10.1007%2F978-0-387-22456-5_2</a></p>
</div>
<div id="ref-Fiske2011">
<p>Fiske, I., &amp; Chandler, R. (2011). unmarked : An R Package for fitting hierarchical models of wildlife occurrence and abundance. <em>Journal of Statistical Software</em>, <em>43</em>(10), 1–23. doi: <a href="https://doi.org/10.18637/jss.v043.i10">10.18637/jss.v043.i10</a></p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="function1.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="bayesian.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"linkedin": true,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/dlizcano/IntroOccuBook/edit/master/06-unmarked.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["IntroOccuBook.pdf"],
"toc": {
"collapse": "subsection"
},
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
